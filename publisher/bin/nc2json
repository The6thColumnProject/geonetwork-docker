#!/bin/bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
source $SCRIPT_DIR/../helper.sh
local_env

#remove last param
array=( "$@" )
last_arg=${array[${#array[@]}-1]}
unset array[${#array[@]}-1]

#reset positional parameters to what's left
set -- "${array[@]}"

#find the root dir and share that with the container
if [[ -f "$last_arg" ]]; then
    data="$(dirname "$(fullpath "$last_arg")")"
    target="/data/$(basename "$(fullpath "$last_arg")")"
elif [[ -d "$last_arg" ]]; then
    data="$(fullpath "$last_arg")"
else
    #this is something else...
    target="$last_arg"
fi


options="$options $DOCKER_EXTENDED_ENV"

if [[ "$data" ]]; then
   options="$options -v $data:/data:ro -e DATA_PATH=$data"
   [[ -z "$target" ]] && target=/data
fi

docker run --rm  $options $image /scripts/to_json.py --show --dry-run "$@" "$target"
